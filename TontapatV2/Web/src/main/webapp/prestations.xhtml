<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- To talk to Marc about header -->	
<h:head>
	<ui:insert name="head"></ui:insert>
</h:head>

<ui:composition template="/arch.xhtml">

	<ui:define name="head">
		<title>Mes Prestations</title>
		<!-- <f:metadata>
			<f:event listener="#{mbAccount.disconnect()}" type="preRenderView"></f:event>
		</f:metadata> -->
	</ui:define>
	
	<ui:define name="content">
		<div class="terrainsTitre">
			<h1>Vos Prestation, <h:outputLabel value="#{mbCompte.utilisateur.nom}" /> !</h1>
		</div>
		<forme>
		<button class="terrainsAjoutTroupeau" >
			<p>Déclarer un incident</p>
			<b:iconAwesome value="plus-circle" solid="true" size="3x"/>
		</button>
</forme>
		<div class="terrainsDivs">
			<ui:repeat class="terrainsBigDiv" var="prestaBU" value="#{mbPresta.prestations}">
				<div class="terrainsBigDiv">
					<div class="terrainSmallDiv">
						<p>State <h:outputLabel value="#{prestaBU.value.stateString}" /></p>
						<p>Debut de prestation : <h:outputLabel value="#{prestaBU.value.prestation.debutPrestation}" /></p>
						<p>Fin de prestation : <h:outputLabel value="#{prestaBU.value.prestation.finPrestation}" /></p>
						<p>Prix : <h:outputLabel value="#{prestaBU.value.prestation.coutPrestation}" /></p>
						<p>Liste des animaux : <h:outputLabel value="Somme à calculer avec EL"/></p>
						<ul>
						<ui:repeat var="animaux" value="#{prestaBU.value.prestation.compositionTroupeauPrestations}">
							<li>
								<h:outputLabel value="#{animaux.nbAnimaux}"/>
								<h:outputLabel value="#{animaux.raceRef.libelleRace}"/>
								<h:outputLabel value="#{animaux.raceRef.ugb}"/>
							</li>
						</ui:repeat>
						</ul>
						<p>Liste des équipements commandés pour la prestation :</p>
						<ul>
						<ui:repeat var="equip" value="#{prestaBU.value.prestation.quantiteEquipementPrestations}" >
							<li>
								<h:outputLabel value="#{equip.equipement.libelleEquipement}"/> :
								<h:outputLabel value="#{equip.quantite}"/>
								<h:outputLabel value="#{equip.equipement.uniteRef.libelleUnite}"/>
							</li>
						</ui:repeat>
						</ul>
						<ui:repeat var="eval" value="#{prestaBU.value.prestation.evaluations}" >
							<p>Note : <h:outputLabel value="#{eval.note}" /></p>
							<p>Commentaire : <h:outputLabel value="#{eval.commentaire}" /></p>
						</ui:repeat>
						<b:button class="prestationButtonIncident"
							value="Déclarer un incident"
							onclick="$('.modalPseudoClass${status.index.incident}').modal()" />
							
						<ul>
							<h:outputLabel value="#{mbPresta.incidentRefSelectionne}"/> 
						</ul>
					</div>
				</div>
			</ui:repeat>
			
			<b:modal id="amodal${status.index.incident}"
					title="Incidents"
					styleClass="modalPseudoClass${status.index.incident}" closable="false"
					close-on-escape="false" backdrop="false">

				<p>Selectionner un incident dans la liste ci-dessous :</p>
				<form method="post" action="prestations.xhtml">
            <h:selectOneMenu id="idIncidentRefSelectionn" value="{#{mbPresta.incidentRefSelectionne}">
            	<f:selectItems var="inc" value="#{mbPresta.incidentRef}" itemValue="#{inc}" itemLabel="#{inc.libelleIncident}" />
            </h:selectOneMenu>
            <br/>
            <input type="submit" value="Valider"/>
           
				</form>
			<f:facet name="footer">
						<h:form>
							<b:button value="Close" dismiss="modal" />
						</h:form>
					</f:facet>
				</b:modal>
				
		</div>
		
		<!--  test State, out of loop ui:repeat it is ok, inside problem : maybe more to come-->
	<!-- https://stackoverflow.com/questions/3362487/dynamic-uiinclude-inside-uirepeat-is-there-a-simple-solution -->
		Test : <h:outputLabel value="#{mbPresta.prestations[0].templateXhtml}"/>
<!-- 	<ui:repeat var="prestaBU" value="#{mbPresta.prestations}" > -->
		<div class="terrainsDivs">
			<c:forEach var="prestaBU" items="#{mbPresta.prestations}" >
				<div class="terrainsBigDiv">
					<div class="terrainSmallDiv">
						<ui:include src="#{prestaBU.value.templateXhtml}">
							<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
							<ui:param name="user" value="#{mbCompte}" />
							<!-- no need to pass #mbPresta (include ?) -->
						</ui:include>
					</div>
				</div>
			</c:forEach>
		</div>
		
		
		
		<h:form>
			<ui:repeat var="prestaBU" value="#{mbPresta.prestations}" >
<!-- 		<b:commandButton value="Déclarer un incident" look="primary" -->
<!-- 								action="#{mbPresta.declarerIncident(prestaBU.value.prestation.idPrestation)}" /> -->
				<b:button value="declarer un incident" outcome="incidents">
					<f:param name="idprestation" value="#{prestaBU.value.prestation.idPrestation}"/>
				</b:button>
			</ui:repeat>
		</h:form>
		HelloWorld <h:outputLabel value="#{mbPresta.incidentRef}"/>
		
</ui:define>
</ui:composition>
</html>