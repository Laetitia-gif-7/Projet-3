<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- To talk to Marc about header -->	
<h:head>
	<ui:insert name="head"></ui:insert>
</h:head>

<ui:composition template="/arch.xhtml">

	<ui:define name="head">
		<title>Mes Prestations</title>
		<!-- <f:metadata>
			<f:event listener="#{mbAccount.disconnect()}" type="preRenderView"></f:event>
		</f:metadata> -->
	</ui:define>
	
	<ui:define name="content">
		<div class="terrainsTitre">
			<h:panelGroup rendered="#{not empty mbCompte.utilisateur}">
        		<h1>Vos Prestations, <h:outputLabel value="#{mbCompte.utilisateur.nom}" /> !</h1>
    		</h:panelGroup>
		</div>
		<h:panelGroup rendered="#{empty mbCompte.utilisateur}">
			<div class="userNotConnected">
				<h1>Vous devez vous connecter pour accéder à vos troupeaux !</h1>
				<a class="troupeauxAjoutTroupeau" href="login.xhtml">
					<p>Se connecter</p>
				</a>
			</div>
		</h:panelGroup>
		<h:panelGroup rendered="#{not empty mbCompte.utilisateur}">
			<b:button value="Rechercher une prestation/Devenir Berger" class="buttonRechercherPresta" href="rechercheBerger.xhtml" >
			</b:button>
	
	
			<!--  test State, out of loop ui:repeat it is ok, inside problem : maybe more to come-->
			<!-- https://stackoverflow.com/questions/3362487/dynamic-uiinclude-inside-uirepeat-is-there-a-simple-solution -->
			<!-- 	<ui:repeat var="prestaBU" value="#{mbPresta.prestations}" > -->
			<b:tabView activeIndex="0" class="prestationsTab">
			<b:tab title="En Cours">
			<div class="terrainsDivs">
				<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
					<h:panelGroup><!--  rendered="#{prestaBU.value.prestation.debutPrestation.compareTo(date.now)<0 && prestaBU.value.prestation.finPrestation.compareTo(date.now)>0 && (prestaBU.value.prestation.debutPrestation.contratBerger || prestaBU.value.prestation.debutPrestation.contratEleveur || prestaBU.value.prestation.debutPrestation.contratClient) !== null}">-->
						<div class="terrainBigDiv">
							<div class="terrainSmallDiv">
								<ui:include src="#{prestaBU.value.templateXhtml}" >
									<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
									<ui:param name="user" value="#{mbCompte}" />
									<!-- no need to pass #mbPresta (include ?) -->
								</ui:include>
								<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
							</div>
						</div>
					</h:panelGroup>
					<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
					  <ui:include src="#{prestaBU.value.templateXhtml}">
							<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
							<ui:param name="user" value="#{mbCompte}" />
							<!-- no need to pass #mbPresta (include ?) -->
						</ui:include>
					  	<f:facet name="footer">
							  <b:button value="Close" dismiss="modal" />
							  <b:button value="Declarer un incident" look="primary" dismiss="modal" />
							  <b:button value="Arrêter la prestation" look="primary" dismiss="modal" />
					  </f:facet>
					</b:modal>
				</c:forEach>
				</div>
		  </b:tab>
		  <b:tab title="En Attentes">
		  <div class="terrainsDivs">
		  	<f:facet name="anchor"><b:iconAwesome name="cog" spin="true" /></f:facet>
				<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
					<h:panelGroup rendered="#{prestaBU.value.stateString == 'CONFIRMEPARELEVEUR' || prestaBU.value.stateString == 'RESERVEPARCLIENT' || prestaBU.value.stateString == 'RESERVEPARELEVEUR'}">
						<div class="terrainBigDiv">
							<div class="terrainSmallDiv">
								<ui:include src="#{prestaBU.value.templateXhtml}">
									<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
									<ui:param name="user" value="#{mbCompte}" />
									<!-- no need to pass #mbPresta (include ?) -->
								</ui:include>
								<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
							</div>
						</div>
					</h:panelGroup>
					<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
					  <ui:include src="#{prestaBU.value.templateXhtml}">
							<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
							<ui:param name="user" value="#{mbCompte}" />
							<!-- no need to pass #mbPresta (include ?) -->
						</ui:include>
					  <f:facet name="footer">
					  	<h:form>
					    	<b:button value="Close" dismiss="modal" />
					    	<b:button value="Valider la prestation" look="primary" dismiss="modal" />
					    	<b:button value="Annuler la prestation" look="primary" dismiss="modal" />
					  	</h:form>
					  </f:facet>
					</b:modal>
				</c:forEach>
				</div>
		  </b:tab>
		  <b:tab title="Terminées">
			<div class="terrainsDivs">
				<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
					<h:panelGroup> <!-- rendered="#{}" -->
						<div class="terrainBigDiv">
							<div class="terrainSmallDiv">
								<ui:include src="#{prestaBU.value.templateXhtml}">
									<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
									<ui:param name="user" value="#{mbCompte}" />
									<!-- no need to pass #mbPresta (include ?) -->
								</ui:include>
								<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
							</div>
						</div>
					</h:panelGroup>
					<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
					  <ui:include src="#{prestaBU.value.templateXhtml}">
							<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
							<ui:param name="user" value="#{mbCompte}" />
							<!-- no need to pass #mbPresta (include ?) -->
						</ui:include>
					  		<f:facet name="footer">
					    		<b:button value="Close" dismiss="modal" />
					  		</f:facet>
					</b:modal>
				</c:forEach>
			</div>
		  </b:tab>
		  <b:tab title="Annulées">
		  <div class="terrainsDivs">
				<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
					<h:panelGroup rendered="#{prestaBU.value.stateString == 'ANNULER'}">
						<div class="terrainBigDiv">
							<div class="terrainSmallDiv">
								<ui:include src="#{prestaBU.value.templateXhtml}">
									<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
									<ui:param name="user" value="#{mbCompte}" />
									<!-- no need to pass #mbPresta (include ?) -->
								</ui:include>
								<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
							</div>
						</div>
					</h:panelGroup>
					<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
					  <ui:include src="#{prestaBU.value.templateXhtml}">
						<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
						<ui:param name="user" value="#{mbCompte}" />
						<!-- no need to pass #mbPresta (include ?) -->
					</ui:include>
					  <f:facet name="footer">
					    <b:button value="Close" dismiss="modal" />
					  </f:facet>
					  
					</b:modal>
				</c:forEach>
				</div>
		  </b:tab>
		</b:tabView>
	</h:panelGroup>
</ui:define>

		
		
</ui:composition>
</html>