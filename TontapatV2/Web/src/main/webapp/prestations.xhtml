<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

<!-- To talk to Marc about header -->	
<h:head>
	<ui:insert name="head"></ui:insert>
</h:head>

<ui:composition template="/arch.xhtml">

	<ui:define name="head">
		<title>Mes Prestations</title>
		<!-- <f:metadata>
			<f:event listener="#{mbAccount.disconnect()}" type="preRenderView"></f:event>
		</f:metadata> -->
	</ui:define>
	
	<ui:define name="content">
		<div class="terrainsTitre">
			<h1>Vos Prestations, <h:outputText value="#{mbCompte.utilisateur.nom}" /> !</h1>
		</div>
		
		<b:button value="Rechercher une prestation/Devenir Berger" class="terrainsAjoutTroupeau" href="rechercheBerger.xhtml" >
		</b:button>


		<!--  test State, out of loop ui:repeat it is ok, inside problem : maybe more to come-->
		<!-- https://stackoverflow.com/questions/3362487/dynamic-uiinclude-inside-uirepeat-is-there-a-simple-solution -->
		<!-- 	<ui:repeat var="prestaBU" value="#{mbPresta.prestations}" > -->
		<b:tabView activeIndex="0" class="terrainsDivs">
		<b:tab title="En Cours">
			<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
				<h:panelGroup><!--  rendered="#{prestaBU.value.prestation.debutPrestation.compareTo(date.now)<0 && prestaBU.value.prestation.finPrestation.compareTo(date.now)>0 && (prestaBU.value.prestation.debutPrestation.contratBerger || prestaBU.value.prestation.debutPrestation.contratEleveur || prestaBU.value.prestation.debutPrestation.contratClient) !== null}">-->
					<div class="terrainBigDiv">
						<div class="terrainSmallDiv">
							<ui:include src="#{prestaBU.value.templateXhtml}" >
								<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
								<ui:param name="user" value="#{mbCompte}" />
								<!-- no need to pass #mbPresta (include ?) -->
							</ui:include>
							<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
							
							<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
				  <ui:include src="#{prestaBU.value.templateXhtml}">
						<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
						<ui:param name="user" value="#{mbCompte}" />
						<!-- no need to pass #mbPresta (include ?) -->
					</ui:include>
				  	<f:facet name="footer">
						  <b:button value="Close" dismiss="modal" />
						  <b:button value="Declarer un incident" look="primary" dismiss="modal" />
						  <b:button value="Arrêter la prestation" look="primary" dismiss="modal" />
				  </f:facet>
				</b:modal>
						</div>
					</div>
				</h:panelGroup>
				
			</c:forEach>
	  </b:tab>
	  <b:tab title="En Attentes">
	  	<f:facet name="anchor"><b:iconAwesome name="cog" spin="true" /></f:facet>
			<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
				<h:panelGroup rendered="#{prestaBU.value.stateString == 'CONFIRMEPARELEVEUR' || prestaBU.value.stateString == 'RESERVEPARCLIENT' || prestaBU.value.stateString == 'RESERVEPARELEVEUR'}">
					<div class="terrainBigDiv">
						<div class="terrainSmallDiv">
							<ui:include src="#{prestaBU.value.templateXhtml}">
								<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
								<ui:param name="user" value="#{mbCompte}" />
								<!-- no need to pass #mbPresta (include ?) -->
							</ui:include>
							<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
						</div>
					</div>
				</h:panelGroup>
				<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
				  <ui:include src="#{prestaBU.value.templateXhtml}">
						<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
						<ui:param name="user" value="#{mbCompte}" />
						<!-- no need to pass #mbPresta (include ?) -->
					</ui:include>
				  <f:facet name="footer">
				  	<h:form>
				    	<b:button value="Close" dismiss="modal" />
				    	<b:button value="Valider la prestation" look="primary" dismiss="modal" />
				    	<b:button value="Annuler la prestation" look="primary" dismiss="modal" />
				  	</h:form>
				  </f:facet>
				</b:modal>
			</c:forEach>
	  </b:tab>
	  <b:tab title="Terminées">
		<div class="terrainsDivs">
			<c:forEach var="prestaBU" items="#{mbPresta.prestations}" >
				<div class="terrainsBigDiv">
					<div class="terrainSmallDiv">
						<ui:include src="#{prestaBU.value.templateXhtml}">
							<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
							<ui:param name="user" value="#{mbCompte}" />
							<!-- no need to pass #mbPresta (include ?) -->
						</ui:include>
						<h:form>
							<b:commandButton value="Valider" look="primary"
										action="#{mbPresta.signerContrat(prestaBU.value.prestation.idPrestation)}" >
<!-- 									action="#{mbPresta.validerEtatDesLieux(prestaBU.value.prestation.idPrestation)}" > -->
							</b:commandButton>
						</h:form>
					</div>
				</h:panelGroup>
				<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
				  <ui:include src="#{prestaBU.value.templateXhtml}">
						<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
						<ui:param name="user" value="#{mbCompte}" />
						<!-- no need to pass #mbPresta (include ?) -->
					</ui:include>
				  		<f:facet name="footer">
				    		<b:button value="Close" dismiss="modal" />
				  		</f:facet>
				</b:modal>
			</c:forEach>
		</div>
	  </b:tab>
	  <b:tab title="Annulées">
			<c:forEach var="prestaBU" items="#{mbPresta.prestations}" varStatus="status" class="terrainBigDiv">
				<h:panelGroup rendered="#{prestaBU.value.stateString == 'ANNULER'}">
					<div class="terrainBigDiv">
						<div class="terrainSmallDiv">
							<ui:include src="#{prestaBU.value.templateXhtml}">
								<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
								<ui:param name="user" value="#{mbCompte}" />
								<!-- no need to pass #mbPresta (include ?) -->
							</ui:include>
							<b:button  class="PrestationButtonDetail" value="Voir le détail de la prestation" onclick="$('.modalPseudoClass${status.index}').modal()"/>
						</div>
					</div>
				</h:panelGroup>
				<b:modal id="amodal${status.index}" title="Détail de la prestation : #{prestaBU.value.prestation.numeroPrestation}" styleClass="modalPseudoClass${status.index}" backdrop="true" closable="true" close-on-escape="true">
				  <ui:include src="#{prestaBU.value.templateXhtml}">
					<ui:param name="prestaBuByMain" value="#{prestaBU.value}" />
					<ui:param name="user" value="#{mbCompte}" />
					<!-- no need to pass #mbPresta (include ?) -->
				</ui:include>
				  <f:facet name="footer">
				    <b:button value="Close" dismiss="modal" />
				  </f:facet>
				  
				</b:modal>
			</c:forEach>
	  </b:tab>
	</b:tabView>

<!-- 		<p> -->
<!-- 			Incidents en cours : -->
<!-- 			<h:outputLabel -->
<!-- 				value="#{mbPresta.incidentRefSelectionne.libelleIncident}" /> -->
<!-- 		</p> -->
<!-- 		<b:button class="prestationButtonIncident" -->
<!-- 			value="Déclarer un incident" -->
<!-- 			onclick="$('.modalPseudoClass${status.index.incident}').modal()" /> -->
<!-- 		<b:modal id="amodal${status.index.incident}" title="Incidents" -->
<!-- 			styleClass="modalPseudoClass${status.index.incident}" -->
<!-- 			closable="false" close-on-escape="false" backdrop="false"> -->

<!-- 			<p>Selectionner un incident dans la liste ci-dessous :</p> -->
<!-- 			<b:form method="post" action="prestations.xhtml}"> -->
<!-- 				<b:selectOneMenu id="idIncidentRefSelectionn" -->
<!-- 					value="#{mbPresta.incidentRefSelectionne}"> -->
<!-- 					<f:selectItems var="inc" value="#{mbPresta.incidentRef}" -->
<!-- 						itemValue="#{inc}" itemLabel="#{inc.libelleIncident}" /> -->
<!-- 				</b:selectOneMenu> -->
<!-- 				<br /> -->
<!-- 				<b:commandButton value="Valider" -->
<!-- 					action="#{mbPresta.enregistrerUnIncident(prestaBU.value.prestation, mbPresta.incidentRefSelectionne)}" /> -->

<!-- 			</b:form> -->
<!-- 			<f:facet name="footer"> -->
<!-- 				<h:form> -->
<!-- 					<b:button value="Close" dismiss="modal" /> -->
<!-- 				</h:form> -->
<!-- 			</f:facet> -->
<!-- 		</b:modal> -->
		
		
		<p>
			Taches en cours :
			<h:outputLabel
				value="#{mbPresta.tacheRefSelectionne.libelleTache}" />
		</p>
		<ui:fragment rendered="#{(empty mbPresta.tache) or ((not empty mbPresta.tache) and (mbPresta.tache.debutRealisation != null))}">
		<b:button class="prestationButtonTache"
			value="Ajouter une Tache"
			onclick="$('.modalPseudoClass${status.index.tache}').modal()" />
			
			<b:modal id="amodal${status.index.tache}" title="Taches"
			styleClass="modalPseudoClass${status.index.tache}"
			closable="false" close-on-escape="false" backdrop="false">

			<p>Selectionner une tache dans la liste ci-dessous :</p>
			<b:form method="post" action="prestations.xhtml}">
				<b:selectOneMenu id="idTacheRefSelectionn"
					value="#{mbPresta.tacheRefSelectionne}">
					<f:selectItems var="tache" value="#{mbPresta.tacheRefs}"
						itemValue="#{tache}" itemLabel="#{tache.libelleTache}" />
				</b:selectOneMenu>
				<br />
				<b:row>
				<b:column>
					<b:datepicker id="cdate1" mode="toggle-icon" showWeek="true"
							firstDay="1" value="#{mbPresta.pt.debutPlannifiee}" required="true"
							label="Date de début planifiée:" label-col-sm="5" col-sm="6">
					</b:datepicker>
				</b:column>
			</b:row>
			<b:row>
				<b:column>
					<b:datepicker id="cdate2" mode="toggle-icon" showWeek="true"
							firstDay="1" value="#{mbPresta.pt.finPlanifiee}" required="true"
							label="Date de fin planifiée:" label-col-sm="5" col-sm="6" >
					</b:datepicker>
				</b:column>
			</b:row>
				<br />
				<b:commandButton value="Valider"
					action="#{mbPresta.AjoutTache(prestaBU.value.prestation, mbPresta.tacheRefSelectionne)}" />

			</b:form>
			<f:facet name="footer">
				<h:form>
					<b:button value="Close" dismiss="modal" />
				</h:form>
			</f:facet>
		</b:modal>
			
		</ui:fragment>
		<ui:fragment rendered="#{(mbPresta.tache.creationTache != null) and (mbPresta.tache.debutRealisation == null)}">
<!-- 		<b:button class="prestationButtonTache" -->
<!-- 			value="Valider La Tache" -->
<!-- 			onclick="$('.modalPseudoClass${status.index.tache}').modal()" /> -->
			
<!-- 			<b:modal id="amodal${status.index.tache}" title="Taches" -->
<!-- 			styleClass="modalPseudoClass${status.index.tache}" -->
<!-- 			closable="false" close-on-escape="false" backdrop="false"> -->

			<p>Indiquez les dates de réalisation de la tache</p>
			<b:form method="post" action="prestations.xhtml}">
				<br />
				<b:row>
				<b:column>
					<b:datepicker id="cdate1" mode="toggle-icon" showWeek="true"
							firstDay="1" value="#{mbPresta.pt.debutPlannifiee}" required="true"
							label="Date de début de la réalisation:" label-col-sm="5" col-sm="6">
					</b:datepicker>
				</b:column>
			</b:row>
			<b:row>
				<b:column>
					<b:datepicker id="cdate2" mode="toggle-icon" showWeek="true"
							firstDay="1" value="#{mbPresta.pt.finPlanifiee}" required="true"
							label="Date de fin de la réalisation:" label-col-sm="5" col-sm="6" >
					</b:datepicker>
				</b:column>
			</b:row>
			<b:row>
				<b:column>
				  <b:inputTextarea placeholder="Veuillez remplir votre rapport..." value="#{mbPresta.pt.rapport}">
				  </b:inputTextarea>
				</b:column>
			</b:row>
				<br />
				<b:commandButton value="Valider La Tache"
					action="#{mbPresta.ValideTache()}" />

			</b:form>
			<f:facet name="footer">
				<h:form>
					<b:button value="Close" dismiss="modal" />
				</h:form>
			</f:facet>
<!-- 		</b:modal> -->
			
		</ui:fragment>
		

	</ui:define>
</ui:composition>
</html>
